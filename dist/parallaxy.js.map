{"version":3,"file":"parallaxy.js","sources":["../src/parallaxy.js"],"sourcesContent":["\"use strict\";\r\n\r\n//All actual parrallaxy elements\r\nconst ParallaxyElements = [];\r\n\r\n//Default config\r\nconst ParallaxyDefaultconfig = {\r\n  speed: 0.5,\r\n  scale: 1.5,\r\n};\r\n\r\n//Parallaxy handler\r\nclass Parallaxy {\r\n  constructor(config) {\r\n    config = this.verfiyConfiguration(config);\r\n\r\n    this.config = config;\r\n\r\n    this.$el = this.config.element[0]\r\n      ? this.config.element\r\n      : [this.config.element];\r\n\r\n    for (const el of this.$el) {\r\n      el.style.willChange = \"transform\";\r\n    }\r\n\r\n    this.mainEvent = null;\r\n\r\n    this.start();\r\n  }\r\n\r\n  verfiyConfiguration(config) {\r\n    this.windowHeight = window.innerHeight;\r\n\r\n    if (!config.element)\r\n      throw \"[Parallaxy] 'element' must be specified when you create a new Parallaxy object\";\r\n\r\n    if (!config.x && !config.y)\r\n      config.y = { speed: ParallaxyDefaultconfig.speed };\r\n\r\n    if (config.x && !config.x.speed)\r\n      config.x.speed = ParallaxyDefaultconfig.speed;\r\n    if (config.y && !config.y.speed)\r\n      config.y.speed = ParallaxyDefaultconfig.speed;\r\n\r\n    if (config.x && config.x.speed <= 0)\r\n      throw \"[Parallaxy] 'speed' need to be bigger than 0\";\r\n    if (config.y && config.y.speed <= 0)\r\n      throw \"[Parallaxy] 'speed' need to be bigger than 0\";\r\n    if (config.x && config.x.speed > 0.65)\r\n      throw \"[Parallaxy] 'speed' need to be smaller than 0.65\";\r\n    if (config.y && config.y.speed > 0.65)\r\n      throw \"[Parallaxy] 'speed' need to be smaller than 0.65\";\r\n\r\n    if (config.scale < 1)\r\n      throw \"[Parallaxy] 'scale' need to be bigger than 1 (or equal but with overflow)\";\r\n    if (!config.scale) config.scale = ParallaxyDefaultconfig.scale;\r\n\r\n    if (!config.axes) config.axes = this.windowHeight / 2;\r\n\r\n    return config;\r\n  }\r\n\r\n  start() {\r\n    this.mainEvent = this.updatePosition.bind(this);\r\n\r\n    for (const el of this.$el) {\r\n      el.addEventListener(\"load\", () => {\r\n        this.updatePosition();\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\"scroll\", this.mainEvent);\r\n\r\n    this.updatePosition();\r\n  }\r\n\r\n  stop() {\r\n    document.removeEventListener(\"scroll\", this.mainEvent);\r\n  }\r\n\r\n  removeElement(el) {\r\n    this.$el.splice(this.$el.indexOf(el), 1);\r\n    ParallaxyElements.splice(ParallaxyElements.indexOf(el), 1);\r\n\r\n    if (this.$el.length == 0) {\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  adddElement(el) {\r\n    this.$el.push(el);\r\n    ParallaxyElements.push(el);\r\n\r\n    this.stop();\r\n    this.start();\r\n  }\r\n\r\n  reset() {\r\n    for (const el of this.$el) {\r\n      el.style.transform = \"\";\r\n    }\r\n  }\r\n\r\n  verifyParallaxy(el) {\r\n    const gC = el.dataset;\r\n    if (gC.prlX == null && gC.prlY == null) {\r\n      this.removeElement(el);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  matchingBreakingPoint() {\r\n    const breakingPoint = this.config.breakPoint;\r\n\r\n    if (!breakingPoint) return false;\r\n\r\n    if (window.matchMedia(breakingPoint).matches) {\r\n      this.reset();\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  isIntersectingObserver(rec, marge = 50) {\r\n    const height = this.windowHeight;\r\n    const additionalHeight = height / 2;\r\n\r\n    //Because rec is only in read mode\r\n    const pos = {\r\n      top: rec.top,\r\n      bottom: rec.bottom,\r\n    };\r\n\r\n    pos.top = pos.top - marge;\r\n    pos.bottom = pos.bottom + marge;\r\n\r\n    let vIntersect = false;\r\n\r\n    let topCondition =\r\n      pos.top >= -additionalHeight && pos.top <= height + additionalHeight;\r\n    let bottomCondition =\r\n      pos.bottom >= -additionalHeight &&\r\n      pos.bottom <= height + additionalHeight;\r\n\r\n    if (topCondition || bottomCondition || (pos.top < 0 && pos.bottom > height))\r\n      vIntersect = true;\r\n\r\n    if (vIntersect) return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  updatePosition() {\r\n    const breaking = this.matchingBreakingPoint();\r\n\r\n    if (!breaking)\r\n      for (const el of this.$el) {\r\n        if (!el.isConnected) {\r\n          this.removeElement(el);\r\n          continue;\r\n        }\r\n\r\n        const rec = el.getBoundingClientRect();\r\n\r\n        const valid = this.verifyParallaxy(el);\r\n        const intersecting = this.isIntersectingObserver(rec);\r\n\r\n        if (valid && intersecting) {\r\n          const transform = [];\r\n\r\n          transform.push(this.scale());\r\n\r\n          let translation = { x: 0, y: 0 };\r\n\r\n          if (this.config.y) {\r\n            const transY = this.translateY(rec);\r\n            translation.y = transY;\r\n            transform.push(`translateY(${transY}px)`);\r\n          }\r\n\r\n          if (this.config.x) {\r\n            const transX = this.translateX(rec);\r\n            translation.x = transX;\r\n            transform.push(`translateX(${transX}px)`);\r\n          }\r\n\r\n          el.style.transform = transform.join(\" \");\r\n        }\r\n      }\r\n  }\r\n\r\n  originalRect(rec) {\r\n    const scale = this.config.scale;\r\n\r\n    const top = rec.top;\r\n    const left = rec.left;\r\n    const right = rec.right;\r\n    const bottom = rec.bottom;\r\n\r\n    const width = rec.width / scale;\r\n    const height = rec.height / scale;\r\n\r\n    const additionalHeight = rec.height - height;\r\n    const additionalWidth = rec.width - width;\r\n\r\n    return {\r\n      width,\r\n      height,\r\n      top,\r\n      left,\r\n      right,\r\n      bottom,\r\n      additionalHeight,\r\n      additionalWidth,\r\n    };\r\n  }\r\n\r\n  scale() {\r\n    return `scale(${this.config.scale})`;\r\n  }\r\n\r\n  translateY(rec) {\r\n    const speed = this.config.y.speed;\r\n    const isInverted = this.config.y.inverted;\r\n\r\n    const scaledRect = rec;\r\n    const originalRect = this.originalRect(rec);\r\n\r\n    const scaleSize = originalRect.additionalHeight / 2;\r\n    const elementCenterPosition = scaledRect.top + scaledRect.height / 2;\r\n    const screenMiddleSize = this.config.axes;\r\n    const elementPositionFromTop = screenMiddleSize - elementCenterPosition;\r\n\r\n    let translation = elementPositionFromTop * speed;\r\n    if (isInverted) translation = -translation; //*(speed/4)\r\n\r\n    const newPosition = scaleSize / this.config.scale;\r\n    if (!this.config.y.overflow && Math.abs(translation) >= newPosition) {\r\n      translation = translation < 0 ? -newPosition : newPosition;\r\n    }\r\n\r\n    return translation;\r\n  }\r\n\r\n  translateX(rec) {\r\n    const speed = this.config.x.speed;\r\n    const isInverted = this.config.x.inverted;\r\n\r\n    const scaledRect = rec;\r\n    const originalRect = this.originalRect(rec);\r\n\r\n    const scaleSize = originalRect.additionalWidth / 2;\r\n    const elementCenterPosition = scaledRect.top + scaledRect.height / 2;\r\n    const screenMiddleSize = this.config.axes;\r\n    const elementPositionFromTop = screenMiddleSize - elementCenterPosition;\r\n\r\n    let translation = elementPositionFromTop * speed;\r\n    if (isInverted) translation = -translation; //*(speed/4)\r\n\r\n    const newPosition = scaleSize / this.config.scale;\r\n    if (!this.config.x.overflow && Math.abs(translation) >= newPosition) {\r\n      translation = translation < 0 ? -newPosition : newPosition;\r\n    }\r\n\r\n    return translation;\r\n  }\r\n}\r\n\r\n//Attributes handler\r\nfunction ParallaxyAttributesHandler() {\r\n  let elementsParallaxy = document.querySelectorAll(\r\n    \"[data-prl-y], [data-prl-x]\"\r\n  );\r\n\r\n  for (const el of elementsParallaxy) {\r\n    if (ParallaxyElements.indexOf(el) != -1 || !el.getAttribute) {\r\n      return;\r\n    }\r\n\r\n    ParallaxyElements.push(el);\r\n\r\n    const gC = el.dataset; //global config\r\n\r\n    const x = gC.prlX != null;\r\n    const y = gC.prlY != null;\r\n\r\n    if (x || y) {\r\n      const config = {\r\n        element: el,\r\n      };\r\n\r\n      if (x) {\r\n        const confX = {};\r\n\r\n        //speed x\r\n        const speed = gC.prlSpeedX;\r\n        confX.speed = parseFloat(speed) || ParallaxyDefaultconfig.speed;\r\n\r\n        //invert x\r\n        const invert = gC.prlInvertedX != null;\r\n        confX.inverted = invert;\r\n\r\n        //overflow x\r\n        const overflow = gC.prlOverflowX != null;\r\n        confX.overflow = overflow;\r\n\r\n        config.x = confX;\r\n      }\r\n\r\n      if (y) {\r\n        const confY = {};\r\n\r\n        //speed y\r\n        const speed = gC.prlSpeedY;\r\n        confY.speed = parseFloat(speed) || ParallaxyDefaultconfig.speed;\r\n\r\n        //invert y\r\n        const invert = gC.prlInvertedY != null;\r\n        confY.inverted = invert;\r\n\r\n        //overflow y\r\n        const overflow = gC.prlOverflowY != null;\r\n        confY.overflow = overflow;\r\n\r\n        config.y = confY;\r\n      }\r\n\r\n      //scale\r\n      const scale = gC.prlScale;\r\n      if (scale != null) config.scale = parseFloat(scale);\r\n\r\n      //break point\r\n      const breakPoint = gC.prlBreakpoint;\r\n      if (breakPoint != null) config.breakPoint = breakPoint;\r\n\r\n      //axes\r\n      const axes = gC.prlAxes;\r\n      if (axes != null) config.axes = parseFloat(axes);\r\n\r\n      new Parallaxy(config);\r\n    }\r\n  }\r\n}\r\n\r\n//Observer\r\nfunction ParallaxyObserver() {\r\n  function getMutationObserver() {\r\n    return (\r\n      window.MutationObserver ||\r\n      window.WebKitMutationObserver ||\r\n      window.MozMutationObserver\r\n    );\r\n  }\r\n\r\n  const MutationObserver = getMutationObserver();\r\n\r\n  const observerDOM = new MutationObserver(function (mutations) {\r\n    if (!mutations) return;\r\n\r\n    ParallaxyAttributesHandler();\r\n  });\r\n\r\n  observerDOM.observe(window.document.documentElement, {\r\n    childList: true,\r\n    subtree: true,\r\n    attributes: true,\r\n    removedNodes: true,\r\n  });\r\n}\r\n\r\n//Dom loaded\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n  ParallaxyObserver();\r\n\r\n  ParallaxyAttributesHandler(\r\n    document.querySelectorAll(\"[data-prl-y], [data-prl-x]\")\r\n  );\r\n});\r\n\r\nexport default Parallaxy;\r\n"],"names":["ParallaxyElements","ParallaxyDefaultconfig","Parallaxy","constructor","config","this","verfiyConfiguration","$el","element","el","style","willChange","mainEvent","start","windowHeight","window","innerHeight","x","y","speed","scale","axes","updatePosition","bind","addEventListener","document","stop","removeEventListener","removeElement","splice","indexOf","length","adddElement","push","reset","transform","verifyParallaxy","gC","dataset","prlX","prlY","matchingBreakingPoint","breakingPoint","breakPoint","matchMedia","matches","isIntersectingObserver","rec","marge","height","additionalHeight","pos","top","bottom","vIntersect","topCondition","bottomCondition","isConnected","getBoundingClientRect","valid","intersecting","transY","translateY","transX","translateX","join","originalRect","left","right","width","additionalWidth","isInverted","inverted","scaledRect","scaleSize","elementCenterPosition","translation","newPosition","overflow","Math","abs","ParallaxyAttributesHandler","elementsParallaxy","querySelectorAll","getAttribute","confX","prlSpeedX","parseFloat","invert","prlInvertedX","prlOverflowX","confY","prlSpeedY","prlInvertedY","prlOverflowY","prlScale","prlBreakpoint","prlAxes","MutationObserver","WebKitMutationObserver","MozMutationObserver","mutations","observe","documentElement","childList","subtree","attributes","removedNodes"],"mappings":"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"}